import{R as v}from"./iframe-Cfz2vXeE.js";import{u as C}from"./useProvidedRefOrCreate-Pg3blKRP.js";import{g as h,a as L}from"./iterate-focusable-elements-QzROm7ZI.js";import{p as g}from"./event-listener-signal-Pp6mWBoo.js";g();const p=[];let f;function R(){const e=p.pop();e&&A(e.container,e.initialFocus,e.originalSignal)}function F(e){const r=new AbortController;return e.addEventListener("abort",()=>{r.abort()}),r}function x(e,r){const s=new MutationObserver(l=>{for(const i of l)if(i.type==="childList"&&i.addedNodes.length){if(Array.from(i.addedNodes).filter(a=>a instanceof HTMLElement&&a.classList.contains("sentinel")&&a.tagName==="SPAN").length)return;const n=e.firstElementChild,c=e.lastElementChild,[b,u]=r;n?.classList.contains("sentinel")||e.insertAdjacentElement("afterbegin",b),c?.classList.contains("sentinel")||e.insertAdjacentElement("beforeend",u)}});return s.observe(e,{childList:!0}),s}function A(e,r,s){const l=new AbortController,i=s??l.signal;e.setAttribute("data-focus-trap","active");const o=document.createElement("span");o.setAttribute("class","sentinel"),o.setAttribute("tabindex","0"),o.setAttribute("aria-hidden","true"),o.onfocus=()=>{const t=h(e,!0);t?.focus()};const n=document.createElement("span");n.setAttribute("class","sentinel"),n.setAttribute("tabindex","0"),n.setAttribute("aria-hidden","true"),n.onfocus=()=>{const t=h(e);t?.focus()},Array.from(e.children).filter(t=>t.classList.contains("sentinel")&&t.tagName==="SPAN").length||(e.prepend(o),e.append(n));const b=x(e,[o,n]);let u;function a(t){if(t instanceof HTMLElement&&document.contains(e))if(e.contains(t)){u=t;return}else if(u&&L(u)&&e.contains(u)){u.focus();return}else if(r&&e.contains(r)){r.focus();return}else{const d=h(e);d?.focus();return}}const m=F(i);if(f){const t=f;f.container.setAttribute("data-focus-trap","suspended"),f.controller.abort(),p.push(t)}m.signal.addEventListener("abort",()=>{f=void 0}),i.addEventListener("abort",()=>{e.removeAttribute("data-focus-trap");const t=e.getElementsByClassName("sentinel");for(;t.length>0;)t[0].remove();const d=p.findIndex(T=>T.container===e);d>=0&&p.splice(d,1),b.disconnect(),R()}),document.addEventListener("focus",t=>{a(t.target)},{signal:m.signal,capture:!0}),a(document.activeElement),f={container:e,controller:m,initialFocus:r,originalSignal:i};const E=p.findIndex(t=>t.container===e);if(E>=0&&p.splice(E,1),!s)return l}function H(e,r=[]){const s=C(e?.containerRef),l=C(e?.initialFocusRef),i=e?.disabled,o=v.useRef(),n=v.useRef(null);!n.current&&!e?.disabled&&(n.current=document.activeElement);function c(){o.current?.abort(),e?.returnFocusRef&&e.returnFocusRef.current instanceof HTMLElement?e.returnFocusRef.current.focus():e?.restoreFocusOnCleanUp&&n.current instanceof HTMLElement&&(n.current.focus(),n.current=null)}return v.useEffect(()=>{if(s.current instanceof HTMLElement)if(i)c();else return o.current=A(s.current,l.current??void 0),()=>{c()}},[s,l,i,...r]),{containerRef:s,initialFocusRef:l}}export{H as u};
