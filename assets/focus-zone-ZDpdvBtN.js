import{p as $}from"./event-listener-signal-Pp6mWBoo.js";import{i as _}from"./user-agent-DiCyFeS1.js";import{i as S}from"./iterate-focusable-elements-QzROm7ZI.js";let G=1e4;function Z(){return`__primer_id_${G++}`}const F=new Set(["button","checkbox","color","file","hidden","image","radio","range","reset","submit"]);function Q(t){var n,a;if(!(t instanceof HTMLElement))return!1;const v=t.nodeName.toLowerCase(),w=(a=(n=t.getAttribute("type"))===null||n===void 0?void 0:n.toLowerCase())!==null&&a!==void 0?a:"text",p=t.ariaReadOnly==="true"||t.getAttribute("aria-readonly")==="true"||t.getAttribute("readonly")!==null;return(v==="select"||v==="textarea"||v==="input"&&!F.has(w)||t.isContentEditable)&&!p}$();var l;(function(t){t[t.ArrowHorizontal=1]="ArrowHorizontal",t[t.ArrowVertical=2]="ArrowVertical",t[t.JK=4]="JK",t[t.HL=8]="HL",t[t.HomeAndEnd=16]="HomeAndEnd",t[t.PageUpDown=256]="PageUpDown",t[t.WS=32]="WS",t[t.AD=64]="AD",t[t.Tab=128]="Tab",t[t.Backspace=512]="Backspace",t[t.ArrowAll=3]="ArrowAll",t[t.HJKL=12]="HJKL",t[t.WASD=96]="WASD",t[t.All=511]="All"})(l||(l={}));const X={ArrowLeft:l.ArrowHorizontal,ArrowDown:l.ArrowVertical,ArrowUp:l.ArrowVertical,ArrowRight:l.ArrowHorizontal,h:l.HL,j:l.JK,k:l.JK,l:l.HL,a:l.AD,s:l.WS,w:l.WS,d:l.AD,Tab:l.Tab,Home:l.HomeAndEnd,End:l.HomeAndEnd,PageUp:l.PageUpDown,PageDown:l.PageUpDown,Backspace:l.Backspace},R={ArrowLeft:"previous",ArrowDown:"next",ArrowUp:"previous",ArrowRight:"next",h:"previous",j:"next",k:"previous",l:"next",a:"previous",s:"next",w:"previous",d:"next",Tab:"next",Home:"start",End:"end",PageUp:"start",PageDown:"end",Backspace:"previous"};function B(t){const n=R[t.key];if(t.key==="Tab"&&t.shiftKey)return"previous";const a=_();if(a&&t.metaKey||!a&&t.ctrlKey){if(t.key==="ArrowLeft"||t.key==="ArrowUp")return"start";if(t.key==="ArrowRight"||t.key==="ArrowDown")return"end"}return n}function K(t,n){const a=t.key,v=[...a].length,w=Q(n);if(w&&(v===1||a==="Home"||a==="End")||n instanceof HTMLSelectElement&&(a==="ArrowDown"&&_()&&!t.metaKey||a==="ArrowDown"&&!_()&&t.altKey))return!0;if(w){const p=n instanceof HTMLTextAreaElement||n instanceof HTMLInputElement,x=p&&n.selectionStart===0&&n.selectionEnd===0,i=p&&n.selectionStart===n.value.length&&n.selectionEnd===n.value.length;if(a==="ArrowLeft"&&!x||a==="ArrowRight"&&!i)return!0;const E=n instanceof HTMLElement&&n.isContentEditable;if((n instanceof HTMLTextAreaElement||E)&&(a==="PageUp"||a==="PageDown"||a==="ArrowUp"&&!x||a==="ArrowDown"&&!i))return!0}return!1}const L="data-is-active-descendant",ee="activated-directly",te="activated-indirectly",y="data-has-active-descendant";function le(t,n){var a,v,w,p,x;const i=[],E=new WeakMap,V=(a=n?.bindKeys)!==null&&a!==void 0?a:(n?.getNextFocusable?l.ArrowAll:l.ArrowVertical)|l.HomeAndEnd,O=(v=n?.focusOutBehavior)!==null&&v!==void 0?v:"stop",A=(w=n?.focusInStrategy)!==null&&w!==void 0?w:"previous",c=n?.activeDescendantControl,T=n?.onActiveDescendantChanged;let f;const h=(p=n?.preventScroll)!==null&&p!==void 0?p:!1;function H(){return i[0]}function W(){return document.activeElement===c}function b(e,o=!1){const r=f;if(f=e,c){e&&W()?C(r,e,o):N();return}r&&r!==e&&E.has(r)&&r.setAttribute("tabindex","-1"),e?.setAttribute("tabindex","0")}function C(e,o,r=!1){o.id||o.setAttribute("id",Z()),e&&e!==o&&e.removeAttribute(L),!(!c||!r&&c.getAttribute("aria-activedescendant")===o.id)&&(c.setAttribute("aria-activedescendant",o.id),t.setAttribute(y,o.id),o.setAttribute(L,r?ee:te),T?.(o,e,r))}function N(e=f){A==="first"&&(f=void 0),c?.removeAttribute("aria-activedescendant"),t.removeAttribute(y),e?.removeAttribute(L);for(const o of t.querySelectorAll(`[${L}]`))o?.removeAttribute(L);T?.(void 0,e,!1)}function M(...e){const o=e.filter(r=>{var d,u;return(u=(d=n?.focusableElementFilter)===null||d===void 0?void 0:d.call(n,r))!==null&&u!==void 0?u:!0});if(o.length!==0){i.splice(J(o),0,...o);for(const r of o)E.has(r)||E.set(r,r.getAttribute("tabindex")),r.setAttribute("tabindex","-1");f||b(H())}}function J(e){const o=e[0];if(i.length===0)return 0;let r=0,d=i.length-1;for(;r<=d;){const u=Math.floor((r+d)/2),g=i[u];q(o,g)?d=u-1:r=u+1}return r}function q(e,o){return(o.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING)>0}function k(...e){for(const o of e){const r=i.indexOf(o);r>=0&&i.splice(r,1);const d=E.get(o);if(d!==void 0&&(d===null?o.removeAttribute("tabindex"):o.setAttribute("tabindex",d),E.delete(o)),o===f){const u=H();b(u)}}}const P={reverse:n?.reverse,strict:n?.strict,onlyTabbable:n?.onlyTabbable};M(...S(t,P));const z=typeof A=="function"?A(document.body):H();b(z),new MutationObserver(e=>{for(const o of e){for(const r of o.removedNodes)r instanceof HTMLElement&&k(...S(r));o.type==="attributes"&&o.oldValue===null&&o.target instanceof HTMLElement&&k(o.target)}for(const o of e){for(const r of o.addedNodes)r instanceof HTMLElement&&M(...S(r,P));o.type==="attributes"&&o.oldValue!==null&&o.target instanceof HTMLElement&&M(o.target)}}).observe(t,{subtree:!0,childList:!0,attributeFilter:["hidden","disabled"],attributeOldValue:!0});const U=new AbortController,m=(x=n?.abortSignal)!==null&&x!==void 0?x:U.signal;m.addEventListener("abort",()=>{k(...i)});let D;t.addEventListener("mousedown",e=>{e.target instanceof HTMLElement&&e.target!==document.activeElement&&(D=i.indexOf(e.target))},{signal:m}),c?(t.addEventListener("focusin",e=>{e.target instanceof HTMLElement&&i.includes(e.target)&&(c.focus({preventScroll:h}),b(e.target))},{signal:m}),t.addEventListener("mousemove",({target:e})=>{if(!(e instanceof Node))return;const o=i.find(r=>r.contains(e));o&&b(o)},{signal:m,capture:!0}),c.addEventListener("focusin",()=>{f?C(void 0,f):b(H())},{signal:m}),c.addEventListener("focusout",()=>{N()},{signal:m})):t.addEventListener("focusin",e=>{if(e.target instanceof HTMLElement){if(D!==void 0)D>=0&&i[D]!==f&&b(i[D]),D=void 0;else if(A==="previous")b(e.target);else if(A==="closest"||A==="first")if(e.relatedTarget instanceof Element&&!t.contains(e.relatedTarget)){const o=I==="previous"?i.length-1:0,r=i[o];r?.focus({preventScroll:h});return}else b(e.target);else if(typeof A=="function")if(e.relatedTarget instanceof Element&&!t.contains(e.relatedTarget)){const o=A(e.relatedTarget);if((o?i.indexOf(o):-1)>=0&&o instanceof HTMLElement){o.focus({preventScroll:h});return}else console.warn("Element requested is not a known focusable element.")}else b(e.target)}I=void 0},{signal:m});const j=c??t;let I;A==="closest"&&document.addEventListener("keydown",e=>{e.key==="Tab"&&(I=B(e))},{signal:m,capture:!0});function Y(){if(!f)return 0;const e=i.indexOf(f);return e!==-1?e:f===t?-1:0}return j.addEventListener("keydown",e=>{var o;if(e.key in R){const r=X[e.key];if(!e.defaultPrevented&&(r&V)>0&&!K(e,document.activeElement)){const d=B(e);let u;if(n?.getNextFocusable&&(u=n.getNextFocusable(d,(o=document.activeElement)!==null&&o!==void 0?o:void 0,e)),!u){const g=Y();let s=g;d==="previous"?s-=1:d==="start"?s=0:d==="next"?s+=1:s=i.length-1,s<0&&(O==="wrap"&&e.key!=="Tab"?s=i.length-1:s=0),s>=i.length&&(O==="wrap"&&e.key!=="Tab"?s=0:s=i.length-1),g!==s&&(u=i[s])}c?b(u||f,!0):u&&(I=d,u.focus({preventScroll:h})),(e.key!=="Tab"||u)&&e.preventDefault()}}},{signal:m}),U}export{l as F,ee as a,te as b,le as f,y as h,L as i};
